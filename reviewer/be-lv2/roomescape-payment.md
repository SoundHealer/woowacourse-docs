# 방탈출 예약 대기

---

## 리뷰어 가이드
안녕하세요! 벌써(혹은 드디어😅)마지막 미션이네요. 이번 미션은 외부 API를 연동하는 경험이 메인입니다! <br>
처음으로 우테코 미션에서 외부 API연동을 다루는데요. 현실과 가까운 경험을 좀 더 일찍 해보는 시도로, 이번 미션이 설계 되었습니다.
처음 추가되는 요구사항이지만, 이미 현업에 계신 리뷰어분들은 한 번쯤은 해보셨을 작업이라 리뷰에 큰 어려움은 없으실 것으로 예상합니다.
외부 API(3rd party API) 연동 작업을 처음하는 신입 개발자를 상상하면서, 아래 사항을 미션 요구사항으로 결정했습니다. 
- 외부 API 응답 성공 시: 필요한 데이터 저장
- 외부 API 응답 실패 시: 에러 핸들링, 적절한 에러 메시지 작성  

<br>
이번에 연동하는 외부 API가 toss의 결제 API라, 결제 도메인에 대한 리뷰를 해야한다는 부담을 느끼실 수도 있을 것 같아 자세한 배경을 설명드립니다.
방탈출 미션의 '예약' 도메인과 '결제'가 자연스럽게 이어질 수 있고, 초보자가 연동작업을 하기에 친절한 문서가 있는 API를 찾은 결과 toss 결제 API를 선택했습니다.
여러 외부 API(환율,날씨 등)중 결제 API 가 선택되었고, 결제를 학습하려는 의도는 없었습니다.   

**이번 미션은 외부 API 호출과 연동이 최우선 학습 목표입니다.** <br> 
그래서 실제 결제 연동 시 고려하는 `보안, 내부/외부 시스템의 데이터 정합성, 내부 DB 트랜잭션(ex.롤백) 등` 은 이번 미션에서 다루지 않습니다.
흥미로운 학습 키워드들이지만 크루들이 한 번에 소화할 수 있는 범위를 넘어선다고 판단했어요. 이 키워드들은 레벨3,4에서 만나게 될 예정입니다. 
따라서 이번 미션에서는 복잡한 결제 도메인 리뷰에 대한 부담은 가지지 않으셔도 됩니다.😄

언제나처럼 크루가 이번 미션에서 학습하려는 학습목표를 충분히 달성했는지를 우선적으로 확인해 주세요.
또한, 이번 미션에서 일부러 특정 HTTP Client 지정하거나, 테스트 작성을 언급하지 않았습니다. 
작은 기술적 의사결정이라도 스스로 충분한 고민 후 선택하고, 나만의 근거가 있는 결정을 해보기를 기대했기 때문입니다. 
리뷰 포인트를 참고하여 의사결정 배경을 물어봐주시면, 크루들은 자신의 결정을 설명하면서 한번 더 학습(a.k.a.메타인지)하게 될 거에요.

---

## 경험해야할 학습 목표

- 외부 API(third party API)를 연동하는 경험
- 외부 API(third party API) 연동 시, 에러 핸들링
- 신규 도메인(결제) 추가 시, 설계 및 구현
- 외부 API 연동 시, 테스트 전략 선택 및 테스트 

## 결제 API 연동 작업에서 미션 작업 범위
- 결제 성공시, API call flow 
![방탈출 토스결제 성공 시퀀스 다이어그램](https://github.com/woowacourse/woowacourse-docs/assets/120355873/50a324f1-29c4-4e81-baa6-eb47852175f5)

---

## 리뷰 포인트

### 1단계
- 외부 API(third party API)를 연동 시 적절한 개발 의사결정을 했는가?
  - 구현 시 사용한 HTTP Client를 선택한 이유는 무엇인가? 선택 과정에서 충분한 리서치와, 합리적인 고민이 있었는가?
  - timeout 시간을 설정했는가? 설정했다면, 특정 시간으로 설정한 이유는 무엇인가?
  

- 외부 API 연동 에러 핸들링을 충분히 구현했는가?
  - 외부 API 호출 실패 시 받은 결제 에러 사유를 사용자도 확인 할 수 있는가?
  - HTTP Client가 API 호출에 실패 했을때 발생하는 예외(ex.RestClientException)가 별도의 처리없이 상위로 전파되거나 사용자에게 노출되지 않고, 예외가 전환되도록 처리했는가?
  - 예외 전환 시, 원래 발생한 예외(cause exception)에 대한 로그를 확인 할 수 있는가?
  - timeout 에 대한 고려를 했는가? timeout 설정이 추가되어 있는가? 


- 연동 작업에 필요한 테스트가 있는가? 해당 테스트 방식이 테스트 목적에 적절한가?
  - 테스트 타겟과 목적이 무엇인가? 원하는 테스트 목적과 타겟에 맞는 테스트 방식을 선택했는가?
    - ex1. 외부 API의 정상동작 확인이 목적이라면 curl로 toss API를 호출해보는 것도 하나의 테스트 방법이다.
    - ex2. 테스트코드에서 반복적인 외부 API 호출을 하지 말아한다고 판단해서, 구현해두고 `@Disabled`를 사용할 수도 있다.
    - ex3. 코드에서 API 호출 부분을 mocking 할 수도 있다.
  - 테스트 방식이 한 가지가 아니기 떄문에, 테스트 작성자의 의도와 해결하려는 방식이 적합한지가 더 중요하다. 

### 2단계
- 신규 도메인으로 결제를 추가하고, DB를 적절히 설계했는가?
  - 외부 API의 결제 응답에서, 특정 필드만 선택해 도메인을 설계 했을 때 그 이유는 무엇인가? 저장하지 않는 값에 대한 결정 근거는 무엇인가? 
  - 외부 API의 응답 필드 중에서 원하는 필드만 선택적으로 저장하고, 가져올 수 있는가?

  
- 기존 도메인인 예약과 결제의 DB 연관관계가 적절하게 맵핑되었는가?  
  - 결제가 없는 예약도 가능하다는 정책을 가정했다면(ex.현재 관리자 페이지에서는 결제없이 예약이 가능), 연관 관계가 적절한가?
  - 결제와 예약의 상태를 일치시켜야 하는 것은 필수 요구사항이 아님(ex.결제 실패시, 예약도 실패)

### 4단계
레벨2 마지막 미션인 만큼, 구현한 결과물을 잘 마무리하고
레벨3에서 다른 개발자와 협업 할 준비를 하는 의미로 API문서와 ERD 작성 요구사항을 포함했습니다.
- 다른 개발자가 이해하기 쉬운 API 문서인가? 
  - 다른 개발자가 API 연동 시 필요한 정보가 누락되지 않았는가? 
- DB ERD 문서가 코드에서 구현한 테이블 맵핑과 일치하는가?
  - 관계형 DB의 테이블 간의 관계(ex.1:n/ 1:1 등)가 잘 표현되어있는가? 
